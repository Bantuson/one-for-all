account_creation_task:
  description: >
    Use provided profile data for account creation:
    - Full Name: {full_name}
    - Email: {email}
    - Mobile: {mobile_number}
    - WhatsApp: {whatsapp_number}
    Verify information is correct. Select OTP method (WhatsApp preferred).
    Your final answer MUST include: username, email, cellphone, chosen_otp_method.
  expected_output: >
    A structured JSON object with user credentials ready for OTP sending.
  agent: identity_auth_agent

otp_verification_task:
  description: >
    Send the OTP based on the user's selected method (email or SMS).
    Prompt the user to provide the OTP they received.
    Verify the OTP using Supabase.
    After verification, create a user account and 24hr session record.
    Your final answer MUST confirm successful account creation.
  expected_output: >
    Confirmation message + session token.
  agent: identity_auth_agent

collect_personal_info_task:
  description: >
    Use provided profile data for personal information:
    - Full Name: {full_name}
    - SA ID Number: {id_number}
    - Date of Birth: {date_of_birth}
    - Gender: {gender}
    - Citizenship: {citizenship}
    - Home Address: {physical_address}
    - Email: {email}
    - Cellphone: {mobile_number}
    - Province: {province}
    - Home Language: {home_language}
    Confirm all data is correct. Your final answer MUST be a structured JSON.
  expected_output: >
    SA-standardised applicant personal information.
  agent: application_intake_agent

collect_academic_info_task:
  description: >
    Use provided academic data from profile:
    - Matric Results: {matric_results}
    - Total APS Score: {total_aps_score}
    - Academic Highlights: {academic_highlights}
    Confirm data is correct. Your final answer MUST be a JSON matching SA requirements.
  expected_output: >
    Detailed SA academic history JSON with APS score.
  agent: application_intake_agent

collect_documents_task:
  description: >
    Use provided document status from profile:
    - Available: {documents_available}
    - Missing: {documents_missing}
    Mark available documents as "uploaded", missing as "pending".
    Do NOT block workflow for missing documents.
    Your final answer MUST include document metadata with status per document.
  expected_output: >
    Document metadata JSON with status field per document (uploaded/pending).
  agent: application_intake_agent
  context:
    - collect_personal_info_task
    - collect_academic_info_task

program_selection_task:
  description: >
    Use provided course selections from profile:
    - Course Choices: {course_choices}
    - Primary Institution: {primary_institution}
    The course_choices array contains first and second choice with priority.
    Verify selections align with APS score ({total_aps_score}).
    Your final answer MUST include first_choice and second_choice per university.
  expected_output: >
    JSON list of universities with first_choice and second_choice course details.
  agent: application_intake_agent
  context:
    - collect_academic_info_task

rag_research_task:
  description: >
    For each university and course choice:
      1. Query vector store for course requirements (APS, subjects).
      2. If missing, scrape and store via supabase_rag_store.
      3. Compare applicant APS to first-choice requirements.
      4. If APS below threshold, suggest second-choice as alternative.
    Your final answer MUST include requirements and APS assessment per choice.
  expected_output: >
    Course requirements with APS eligibility assessment per first/second choice.
  agent: rag_specialist_agent
  context:
    - collect_academic_info_task
    - program_selection_task

application_compilation_task:
  description: >
    Compile per university: personal info, academic info, documents (with status),
    first_choice course, second_choice course, RAG requirements.
    Validate all fields and prepare submission payload with choices prioritised.
    Your final answer MUST be a validated payload per university.
  expected_output: >
    Validated application JSON per university with first/second choice courses.
  agent: submission_agent
  context:
    - collect_personal_info_task
    - collect_academic_info_task
    - collect_documents_task
    - program_selection_task
    - rag_research_task

application_submission_task:
  description: >
    Submit to ALL selected universities using application_submission_tool.
    Per university: submit first_choice as primary, second_choice as backup.
    Your final answer MUST include: university, application_id, status,
    first_choice_status, second_choice_status.
  expected_output: >
    JSON list with submission status per university and course choice.
  agent: submission_agent
  context:
    - application_compilation_task

ask_if_apply_for_nsfas_task:
  description: >
    Check profile for NSFAS eligibility:
    - NSFAS Eligible: {nsfas_eligible}
    - Household Income: {household_income}
    - SASSA Recipient: {sassa_recipient}
    If eligible and undergrad, return YES_NSFAS. If postgrad, return NO_NSFAS.
    Your final answer MUST be: "YES_NSFAS" or "NO_NSFAS"
  expected_output: >
    YES_NSFAS or NO_NSFAS
  agent: application_intake_agent
  context:
    - program_selection_task

nsfas_collection_task:
  description: >
    Use profile data for NSFAS application:
    - Guardian Employment: {guardian_employment}
    - Household Income: {household_income}
    - SASSA Recipient: {sassa_recipient}
    - Disability Grant: {disability_grant}
    Reuse personal info, academic records from prior tasks.
    Compile NSFAS-specific fields. Store via supabase_nsfas_documents_store.
    Your final answer MUST be complete NSFAS application JSON.
  expected_output: >
    NSFAS application JSON with reused and new data combined.
  agent: nsfas_agent
  context:
    - collect_personal_info_task
    - collect_academic_info_task
    - collect_documents_task

nsfas_submission_task:
  description: >
    Submit NSFAS application via nsfas_application_submission_tool.
    Return: nsfas_application_id and submission status.
    Store application metadata in Supabase.
  expected_output: >
    NSFAS submission confirmation with nsfas_application_id.
  agent: nsfas_agent
  context:
    - nsfas_collection_task

university_status_check_task:
  description: >
    Retrieve status updates for university applications using
    application_status_tool.
    Your final answer MUST summarise the latest known status.
  expected_output: >
    Latest status update.
  agent: submission_agent

nsfas_status_check_task:
  description: >
    Retrieve the latest NSFAS application status using nsfas_status_tool.
    Your final answer MUST summarise:
      - current NSFAS status
      - any outstanding requirements
      - next steps for the student
  expected_output: >
    Latest NSFAS status summary.
  agent: nsfas_agent