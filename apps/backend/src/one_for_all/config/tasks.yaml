account_creation_task:
  description: >
    Collect username, email, and cellphone number from the user.
    Ask which verification method they prefer (email or SMS).
    Your final answer MUST include:
    1. username
    2. email
    3. cellphone
    4. chosen_otp_method
  expected_output: >
    A structured JSON object with user credentials ready for OTP sending.
  agent: identity_auth_agent

otp_verification_task:
  description: >
    Send the OTP based on the user's selected method (email or SMS).
    Prompt the user to provide the OTP they received.
    Verify the OTP using Supabase.
    After verification, create a user account and 24hr session record.
    Your final answer MUST confirm successful account creation.
  expected_output: >
    Confirmation message + session token.
  agent: identity_auth_agent

collect_personal_info_task:
  description: >
    Collect SA-compliant personal information:
    - Full Name
    - South African ID or Passport
    - Date of Birth
    - Gender
    - Citizenship (SA/SADC/International)
    - Home Address
    - Email + Cellphone
    Your final answer MUST return a structured JSON object.
  expected_output: >
    SA-standardised applicant personal information.
  agent: application_intake_agent

collect_academic_info_task:
  description: >
    Collect academic background:
    - Matric/NSC subjects & percentages
    - Highest qualification (if applicable)
    - Previous institution details
    Your final answer MUST be a JSON object that matches SA university requirements.
  expected_output: >
    Detailed SA academic history JSON.
  agent: application_intake_agent

collect_documents_task:
  description: >
    Request SA-required documents (ID, matric/NSC, transcript, residence, payment).
    Accept "I'll provide later" for any document - mark as "pending" in status.
    Do NOT block workflow for missing documents.
    Track each document status in documents_status JSONB field.
    Your final answer MUST include document metadata with status per document.
  expected_output: >
    Document metadata JSON with status field per document (uploaded/pending).
  agent: application_intake_agent
  context:
    - collect_personal_info_task
    - collect_academic_info_task

program_selection_task:
  description: >
    Ask user to choose universities to apply to. For each university, collect:
    - University name, Faculty, Qualification type (Undergrad/Postgrad)
    - FIRST CHOICE course (required)
    - SECOND CHOICE course (optional backup)
    - Year of application
    Query available courses to verify selections exist. Ensure course level
    matches applicant level (undergrad/postgrad).
    Your final answer MUST include first_choice and second_choice per university.
  expected_output: >
    JSON list of universities with first_choice and second_choice course details.
  agent: application_intake_agent
  context:
    - collect_academic_info_task

rag_research_task:
  description: >
    For each university and course choice:
      1. Query vector store for course requirements (APS, subjects).
      2. If missing, scrape and store via supabase_rag_store.
      3. Compare applicant APS to first-choice requirements.
      4. If APS below threshold, suggest second-choice as alternative.
    Your final answer MUST include requirements and APS assessment per choice.
  expected_output: >
    Course requirements with APS eligibility assessment per first/second choice.
  agent: rag_specialist_agent
  context:
    - collect_academic_info_task
    - program_selection_task

application_compilation_task:
  description: >
    Compile per university: personal info, academic info, documents (with status),
    first_choice course, second_choice course, RAG requirements.
    Validate all fields and prepare submission payload with choices prioritised.
    Your final answer MUST be a validated payload per university.
  expected_output: >
    Validated application JSON per university with first/second choice courses.
  agent: submission_agent
  context:
    - collect_personal_info_task
    - collect_academic_info_task
    - collect_documents_task
    - program_selection_task
    - rag_research_task

application_submission_task:
  description: >
    Submit to ALL selected universities using application_submission_tool.
    Per university: submit first_choice as primary, second_choice as backup.
    Your final answer MUST include: university, application_id, status,
    first_choice_status, second_choice_status.
  expected_output: >
    JSON list with submission status per university and course choice.
  agent: submission_agent
  context:
    - application_compilation_task

ask_if_apply_for_nsfas_task:
  description: >
    Check if applicant selected Postgrad - if so, skip NSFAS (return NO_NSFAS).
    For Undergrad only: ask if they want NSFAS funding.
    Your final answer MUST be: "YES_NSFAS" or "NO_NSFAS"
  expected_output: >
    YES_NSFAS or NO_NSFAS
  agent: application_intake_agent
  context:
    - program_selection_task

nsfas_collection_task:
  description: >
    Reuse verified data from prior tasks: personal info, academic records,
    ID documents, address. Only collect NSFAS-specific fields:
    - Guardian details (names, ID, contact)
    - Household composition and income proof
    - NSFAS consent form, bank details, living situation
    Store documents via supabase_nsfas_documents_store.
    Your final answer MUST be complete NSFAS application JSON.
  expected_output: >
    NSFAS application JSON with reused and new data combined.
  agent: nsfas_agent
  context:
    - collect_personal_info_task
    - collect_academic_info_task
    - collect_documents_task

nsfas_submission_task:
  description: >
    Submit NSFAS application via nsfas_application_submission_tool.
    Return: nsfas_application_id and submission status.
    Store application metadata in Supabase.
  expected_output: >
    NSFAS submission confirmation with nsfas_application_id.
  agent: nsfas_agent
  context:
    - nsfas_collection_task

univeristy_status_check_task:
  description: >
    Retrieve status updates for university applications using
    application_status_tool.
    Your final answer MUST summarise the latest known status.
  expected_output: >
    Latest status update.
  agent: submission_agent

nsfas_status_check_task:
  description: >
    Retrieve the latest NSFAS application status using nsfas_status_tool.
    Your final answer MUST summarise:
      - current NSFAS status
      - any outstanding requirements
      - next steps for the student
  expected_output: >
    Latest NSFAS status summary.
  agent: nsfas_agent