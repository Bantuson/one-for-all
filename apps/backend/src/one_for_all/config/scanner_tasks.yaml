# AI Website Scanner Tasks
# Sequential tasks for extracting academic data from institution websites

analyze_html_structure_task:
  description: >
    Analyze the provided HTML content and identify the page type and structure.

    HTML content from: {url}

    Steps:
    1. Identify the page type (campus page, faculty page, course page, etc.)
    2. Extract the main heading and title
    3. Find navigation breadcrumbs if present
    4. Identify key sections containing academic information
    5. Extract all internal links that might lead to academic content

    Return a structured analysis of the page with:
    - Page type classification
    - Main title and headings
    - Key academic content sections
    - Relevant internal links for further crawling
  expected_output: >
    JSON object containing:
    {
      "page_type": "campus|faculty|course|unknown",
      "title": "extracted title",
      "sections": ["list of identified sections"],
      "academic_links": [{"href": "url", "text": "link text", "type": "inferred type"}]
    }
  agent: content_analyzer_agent

extract_campus_info_task:
  description: >
    Extract campus information from the analyzed page content.

    Context from previous analysis: {analysis_result}

    Look for:
    1. Campus name (e.g., "Main Campus", "Howard College", etc.)
    2. Physical location/address
    3. Contact information
    4. List of faculties or schools at this campus
    5. Any unique identifiers or codes

    For South African institutions, common patterns include:
    - Multiple campuses in different cities
    - Named campuses (e.g., "Mafikeng Campus", "Westville Campus")
    - Campus-specific faculties
  expected_output: >
    JSON object with campus data or null if not a campus page:
    {
      "name": "Campus Name",
      "code": "CAMP",
      "location": "City, Province",
      "address": {"street": "", "city": "", "province": "", "postal_code": ""},
      "faculties_mentioned": ["list of faculty names"],
      "confidence": 0.85
    }
  agent: content_analyzer_agent
  context:
    - analyze_html_structure_task

extract_faculty_info_task:
  description: >
    Extract faculty or school information from the analyzed page content.

    Context from previous analysis: {analysis_result}

    Look for:
    1. Faculty/School name (e.g., "Faculty of Engineering", "School of Business")
    2. Faculty code or abbreviation
    3. Description or overview
    4. List of departments or programs
    5. Dean or head of faculty information

    South African university patterns:
    - "Faculty of..." (UCT, Wits, UP style)
    - "School of..." (alternative naming)
    - "College of..." (UNISA style)
  expected_output: >
    JSON object with faculty data or null if not a faculty page:
    {
      "name": "Faculty Name",
      "code": "FAC",
      "description": "Brief description",
      "departments": ["list of departments"],
      "programs_count": 15,
      "confidence": 0.80
    }
  agent: content_analyzer_agent
  context:
    - analyze_html_structure_task

extract_course_info_task:
  description: >
    Extract course/program information from the analyzed page content.

    Context from previous analysis: {analysis_result}

    Look for:
    1. Course/Program name (e.g., "Bachelor of Science in Computer Science")
    2. Course code (e.g., "BSC-CS", "BENG0001")
    3. Duration (typically 3-4 years for undergrad)
    4. Admission requirements:
       - APS score
       - Required subjects (Mathematics, Physical Science, etc.)
       - Minimum subject levels
    5. Career opportunities
    6. Program structure or curriculum overview

    South African qualification patterns:
    - Bachelor's degrees (3-4 years)
    - Honours (1 year post-bachelor's)
    - Master's (1-2 years)
    - Diplomas (3 years)
    - Higher Certificates (1-2 years)
  expected_output: >
    JSON object with course data or null if not a course page:
    {
      "name": "Course Name",
      "code": "COURSE001",
      "duration_years": 4,
      "qualification_type": "Bachelor's Degree",
      "requirements": {
        "minimum_aps": 28,
        "required_subjects": ["Mathematics", "Physical Science"],
        "minimum_levels": {"Mathematics": 5, "Physical Science": 5}
      },
      "description": "Brief course description",
      "confidence": 0.75
    }
  agent: content_analyzer_agent
  context:
    - analyze_html_structure_task

normalize_extracted_data_task:
  description: >
    Normalize and validate all extracted data into a consistent structure.

    Extracted data:
    - Campus: {campus_data}
    - Faculty: {faculty_data}
    - Course: {course_data}

    Steps:
    1. Generate missing codes using consistent naming conventions
    2. Validate required fields are present
    3. Calculate overall confidence scores
    4. Standardize text formatting (title case for names, uppercase for codes)
    5. Ensure relationships are correctly mapped

    Validation rules:
    - Names should be 3-200 characters
    - Codes should be alphanumeric, 2-15 characters
    - APS scores should be between 15-45
    - Duration should be 1-8 years
  expected_output: >
    JSON object with normalized data ready for database:
    {
      "campus": { normalized campus or null },
      "faculty": { normalized faculty or null },
      "course": { normalized course or null },
      "validation_errors": [],
      "overall_confidence": 0.82
    }
  agent: data_structurer_agent
  context:
    - extract_campus_info_task
    - extract_faculty_info_task
    - extract_course_info_task

map_to_schema_task:
  description: >
    Map the normalized data to the institution dashboard database schema.

    Normalized data: {normalized_data}
    Institution ID: {institution_id}

    Database schema requirements:

    campuses table:
    - id (UUID, auto-generated)
    - institution_id (UUID, required)
    - name (string, required)
    - code (string, required, unique per institution)
    - location (string, optional)
    - address (JSONB: street, city, province, postalCode)

    faculties table:
    - id (UUID, auto-generated)
    - institution_id (UUID, required)
    - campus_id (UUID, optional)
    - name (string, required)
    - code (string, required, unique per institution)
    - description (string, optional)

    courses table:
    - id (UUID, auto-generated)
    - institution_id (UUID, required)
    - faculty_id (UUID, required)
    - campus_id (UUID, optional)
    - name (string, required)
    - code (string, required, unique per institution)
    - description (string, optional)
    - requirements (JSONB: minimum_aps, required_subjects, etc.)
    - duration_years (integer, optional, default 4)
    - status (string: active/inactive/archived, default active)

    Generate the final data structure ready for database insertion.
  expected_output: >
    JSON object with database-ready data:
    {
      "campus": { schema-compliant campus object or null },
      "faculty": { schema-compliant faculty object or null },
      "course": { schema-compliant course object or null },
      "ready_for_insert": true,
      "validation_summary": "All fields validated successfully"
    }
  agent: schema_mapper_agent
  context:
    - normalize_extracted_data_task
